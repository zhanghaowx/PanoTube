define("geometries/PanoramaCubeGeometry",["three"],function(){THREE.PanoramaCubeGeometry=function(e,t,i,n,a,o){function r(e,t,i,n,a,o,r,h){var c,l,d,p=s.widthSegments,m=s.heightSegments,u=a/2,E=o/2,f=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",m=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",p=s.depthSegments);var w=p+1,g=m+1,y=a/p,T=o/m,v=new THREE.Vector3;for(v[c]=r>0?1:-1,d=0;g>d;d++)for(l=0;w>l;l++){var R=new THREE.Vector3;R[e]=(l*y-u)*i,R[t]=(d*T-E)*n,R[c]=r,s.vertices.push(R)}for(d=0;m>d;d++)for(l=0;p>l;l++){var M=l+w*d,H=l+w*(d+1),P=l+1+w*(d+1),D=l+1+w*d,b=new THREE.Vector2(l/p,1-d/m),x=new THREE.Vector2(l/p,1-(d+1)/m),S=new THREE.Vector2((l+1)/p,1-(d+1)/m),I=new THREE.Vector2((l+1)/p,1-d/m),O=new THREE.Face3(M+f,H+f,D+f);O.normal.copy(v),O.vertexNormals.push(v.clone(),v.clone(),v.clone()),O.materialIndex=h,s.faces.push(O),s.faceVertexUvs[0].push([b,x,I]),O=new THREE.Face3(H+f,P+f,D+f),O.normal.copy(v),O.vertexNormals.push(v.clone(),v.clone(),v.clone()),O.materialIndex=h,s.faces.push(O),s.faceVertexUvs[0].push([x.clone(),S,I.clone()])}}THREE.Geometry.call(this),this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:a,depthSegments:o},this.widthSegments=n||1,this.heightSegments=a||1,this.depthSegments=o||1;var s=this,h=e/2,c=t/2,l=i/2;r("x","y",1,-1,e,t,-l,0),r("z","y",1,-1,i,t,h,1),r("x","y",-1,-1,e,t,l,2),r("z","y",-1,-1,i,t,-h,3),r("x","z",1,1,e,i,-c,4),r("x","z",1,-1,e,i,c,5),this.mergeVertices()},THREE.PanoramaCubeGeometry.prototype=Object.create(THREE.Geometry.prototype)}),String.prototype.format=String.prototype.f=function(){for(var e=this,t=arguments.length;t--;)e=e.replace(new RegExp("\\{"+t+"\\}","gm"),arguments[t]);return e},String.prototype.leftPad=function(e,t){for(var i=this;i.length<t;)i=e+i;return i},define("core/String",function(){}),define("scene/Cube3D",["geometries/PanoramaCubeGeometry","core/String","three"],function(){var e=1e3,t=0,i=0,n=function(e){this.settings=$.extend({tiles:[],onTilesReady:function(){}},e)};return n.TYPE="cube",n.validate=function(e){if(!e.tiles)return console.debug("Skip creating cube: no tiles defined!"),!1;var i=e.tiles.length/6;switch(i){case 0:break;case 1:t=0;break;case 4:t=1;break;case 16:t=2;break;case 64:t=3;break;default:return console.debug("Skip creating cube: invlaid number of tiles {0}!".format(e.tiles.length)),!1}return!0},n.prototype.getTexture=function(e){THREE.ImageUtils.crossOrigin="";var t=this;return new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e,void 0,function(){i++,i==t.settings.tiles.length&&t.settings.onTilesReady()},function(){console.error("Fail to load "+e)}),overdraw:!0})},n.prototype.createMaterials=function(){for(var e=[],t=this.settings.tiles,i=0;i<t.length;i++)e.push(this.getTexture(t[i]));return new THREE.MeshFaceMaterial(e)},n.prototype.createCube=function(){for(var i=Math.pow(2,t),n=Math.max(i,16),a=new THREE.PanoramaCubeGeometry(e,e,e,n,n,n),o=a.faces.length/2,r=0;o>r;r++){var s=Math.floor(r/n),h=r%n,c=Math.floor(s/(n/i)),l=Math.floor(h/(n/i)),d=c*i+l,p=2*r;a.faces[p].materialIndex=d,a.faces[p+1].materialIndex=d;var m=1/n*i,u=r*m%1,E=1-m-Math.floor(r/n)*m%1,f=new THREE.Vector2(u,E),w=new THREE.Vector2(u,E+m),g=new THREE.Vector2(u+m,E),y=new THREE.Vector2(u+m,E+m);a.faceVertexUvs[0][p]=[w,f,y],a.faceVertexUvs[0][p+1]=[f,g,y]}return new THREE.Mesh(a,this.createMaterials())},n}),define("core/Object3D",["three"],function(){THREE.Object3D.prototype.onMouseDown=function(e,t){},THREE.Object3D.prototype.onMouseUp=function(e,t){},THREE.Object3D.prototype.onMouseMove=function(e,t){}}),define("scene/Sphere3D",["core/Object3D","core/String","three"],function(){var e=function(e){this.settings=$.extend({tiles:[],rows:1,columns:1,dimensionOffset:0},e),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.isInitialized=!1};return e.TYPE="sphere",e.validate=function(e){return e.tiles?!0:(console.debug("Skip creating sphere: no tiles provided!"),!1)},e.prototype.initializeContext=function(e,t){this.isInitialized||(this.isInitialized=!0,this.canvas.width=e,this.canvas.height=t,this.context.translate(this.canvas.width,0),this.context.scale(-1,1),console.debug("Context initialized with dimensions {0}x{1}".format(e,t)))},e.prototype.createSphere=function(){var e=new THREE.SphereGeometry(1e3,60,40);e.scale(-1,1,1);for(var t=this,i=new THREE.Texture(this.canvas),n=0;n<this.settings.rows;n++)for(var a=0;a<this.settings.columns;a++)!function(e,n){var a=new Image;a.addEventListener("load",function(){t.initializeContext(t.settings.columns*(a.width+t.settings.dimensionOffset),t.settings.rows*(a.height+t.settings.dimensionOffset)),t.context.drawImage(this,e*a.width,n*a.height),i.needsUpdate=!0}),a.crossOrigin="",a.src=t.settings.tiles[n*t.settings.columns+e]}(a,n);var i=new THREE.Texture(this.canvas),o=new THREE.MeshBasicMaterial({map:i});return new THREE.Mesh(e,o)},e}),define("core/Math",["three"],function(){THREE.Math.yawPitchToPoint=function(e,t){var i=THREE.Math.degToRad(e),n=THREE.Math.degToRad(t),a=new THREE.Vector3;return a.x=Math.cos(n)*Math.cos(i),a.y=Math.sin(n),a.z=Math.cos(n)*Math.sin(i),a.normalize(),a},THREE.Math.pointToYawPitch=function(e){var t=new THREE.Vector3;t.add(e).normalize();var i=THREE.Math.radToDeg(Math.atan2(t.z,t.x)),n=THREE.Math.radToDeg(Math.asin(t.y));return{yaw:i,pitch:n}}}),define("geometries/RectangleGeometry",["core/Math","three"],function(){THREE.RectangleGeometry=function(e){function t(){var e=a.params.widthInDeg,t=a.params.heightInDeg;return[i(THREE.Math.yawPitchToPoint(-e/2,t/2)),i(THREE.Math.yawPitchToPoint(-e/2,-t/2)),i(THREE.Math.yawPitchToPoint(e/2,t/2)),i(THREE.Math.yawPitchToPoint(e/2,-t/2))]}function i(e){var t=new THREE.Vector3(0,0,1),i=new THREE.Vector3(0,-1,0);return e.applyAxisAngle(t,THREE.Math.degToRad(a.params.pitch)),e.applyAxisAngle(i,THREE.Math.degToRad(a.params.yaw)),e}function n(e,t,n,o){var r=n/2,s=o/2,h=THREE.Math.yawPitchToPoint(e+r,t+s).add(a.center),c=THREE.Math.yawPitchToPoint(e-r,t+s).add(a.center),l=THREE.Math.yawPitchToPoint(e+r,t-s).add(a.center),d=THREE.Math.yawPitchToPoint(e-r,t-s).add(a.center),p=a.vertices.length;a.vertices.push(i(h)),a.vertices.push(i(l)),a.vertices.push(i(c)),a.vertices.push(i(d)),a.faces.push(new THREE.Face3(0+p,2+p,1+p)),a.faces.push(new THREE.Face3(1+p,2+p,3+p))}THREE.Geometry.call(this),this.center=new THREE.Vector3,this.corners=[],this.divide=10,this.params={},this.destroy=function(){this.vertices=[],this.faces=[]},this.build=function(){for(var e=this.params.widthInDeg,i=this.params.heightInDeg,a=this.divide,o=e/a,r=i/a,s=0;a>s;s++)for(var h=-e/2+o*s,c=0;a>c;c++){var l=-i/2+r*c;n(h+o/2,l+r/2,o,r)}this.corners=t(),this.mergeVertices(),this.verticesNeedUpdate=!0,this.elementsNeedUpdate=!0,this.normalsNeedUpdate=!0,this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingSphere()},this.rebuild=function(e){this.params={yaw:e.yaw,pitch:e.pitch,widthInDeg:e.widthInDeg,heightInDeg:e.heightInDeg},this.destroy(),this.build()};var a=this;this.rebuild(e)},THREE.RectangleGeometry.prototype=Object.create(THREE.Geometry.prototype)}),define("mesh/Selection3DMesh",["three","geometries/RectangleGeometry"],function(){THREE.Selection3DMesh=function(e,t,i,n){function a(e){var t=new THREE.Vector3(0,0,-1),i=new THREE.Vector3(0,1,0);return e.applyAxisAngle(i,THREE.Math.degToRad(o.parameters.yaw)),e.applyAxisAngle(t,THREE.Math.degToRad(o.parameters.pitch)),e}this.parameters={},this.cameraPosition=new THREE.Vector3,this.minWidth=.5,this.maxWidth=180,this.minHeight=.5,this.maxHeight=180,this.minPitch=-90,this.maxPitch=90,this.onMouseDown=function(e){this.material.color.setHex(16776960),this.yawPitchOffset=l(e),this.isMoving=!0},this.onMouseMove=function(e){this.isMoving&&(s(e),h())},this.onMouseUp=function(e){this.material.color.setHex(16777215),this.yawPitchOffset=null,this.isMoving=!1},this.controllerMeshes=[],this.addControllers=function(){for(var e=this.rectangleGeometry.corners,t=0;t<e.length;t++){var i=e[t],n=new THREE.MeshBasicMaterial({color:"#ffffff"}),a=new THREE.Mesh(new THREE.CircleGeometry(.01,16),n);a.position=i,a.lookAt(this.cameraPosition),a.onMouseDown=function(){this.material.color.setHex(16776960),this.isResizing=!0},a.onMouseMove=function(e){this.isResizing&&(r(this.position,e),h())},a.onMouseUp=function(){this.material.color.setHex(16777215),this.isResizing=!1},this.controllerMeshes.push(a),this.children.push(a)}},this.rebuild=function(e){d(e.yaw,e.pitch,e.widthInDeg,e.heightInDeg),c(),h()};var o=this,r=function(e,t){var i=THREE.Math.pointToYawPitch(a(e.clone())),n=THREE.Math.pointToYawPitch(a(t.clone())),r=o.parameters.yaw+(n.yaw-i.yaw)/2,s=o.parameters.pitch+(n.pitch-i.pitch)/2,h=Math.abs(i.yaw+n.yaw),l=Math.abs(i.pitch+n.pitch);l=Math.min(2*(o.parameters.pitch-o.minPitch),l),l=Math.min(2*(o.maxPitch-o.parameters.pitch),l),d(r,s,h,l),c()},s=function(e,t){var i=THREE.Math.pointToYawPitch(e),n=i.yaw-o.yawPitchOffset.yaw,a=i.pitch-o.yawPitchOffset.pitch;d(n,a),c()},h=function(){for(var e=o.rectangleGeometry.corners,t=0;t<o.controllerMeshes.length;t++){var i=o.controllerMeshes[t];i.position=e[t%e.length],i.lookAt(o.cameraPosition),i.geometry.verticesNeedUpdate=!0,i.geometry.normalsNeedUpdate=!0,i.geometry.computeFaceNormals(),i.geometry.computeVertexNormals(),i.geometry.computeBoundingSphere()}},c=function(){o.rectangleGeometry.rebuild(o.parameters)},l=function(e){var t=THREE.Math.pointToYawPitch(e);return{yaw:t.yaw-o.parameters.yaw,pitch:t.pitch-o.parameters.pitch}},d=function(e,t,i,n){null!=e&&(o.parameters.yaw=e),null!=t&&(o.parameters.pitch=Math.min(o.maxPitch,Math.max(o.minPitch,t))),null!=i&&(o.parameters.heightInDeg=Math.min(o.maxHeight,Math.max(o.minHeight,n))),null!=n&&(o.parameters.widthInDeg=Math.min(o.maxWidth,Math.max(o.minWidth,i))),p()},p=function(){o.parameters.pitch=Math.min(o.maxPitch-o.parameters.heightInDeg/2,Math.max(o.minPitch+o.parameters.heightInDeg/2,o.parameters.pitch))};d(e,t,i,n);var m=new THREE.MeshBasicMaterial({color:"#ffffff",transparent:!0,opacity:.5,overdraw:.1,side:THREE.DoubleSide});this.rectangleGeometry=new THREE.RectangleGeometry(this.parameters),THREE.Mesh.call(this,this.rectangleGeometry,m)},THREE.Selection3DMesh.prototype=Object.create(THREE.Mesh.prototype)}),define("geometries/RectangleOutlineGeometry",["core/Math","three"],function(){THREE.RectangleOutlineGeometry=function(e){function t(){var e=h.params.widthInDeg,t=h.params.heightInDeg;return[i(THREE.Math.yawPitchToPoint(-e/2,t/2)),i(THREE.Math.yawPitchToPoint(-e/2,-t/2)),i(THREE.Math.yawPitchToPoint(e/2,t/2)),i(THREE.Math.yawPitchToPoint(e/2,-t/2))]}function i(e){var t=new THREE.Vector3(0,0,1),i=new THREE.Vector3(0,-1,0);return e.applyAxisAngle(t,THREE.Math.degToRad(h.params.pitch)),e.applyAxisAngle(i,THREE.Math.degToRad(h.params.yaw)),e}function n(e,t,i){var n=THREE.Math.yawPitchToPoint(e.yaw,e.pitch).add(h.center),a=THREE.Math.yawPitchToPoint(t.yaw,t.pitch).add(h.center),o=THREE.Math.yawPitchToPoint(e.yaw,e.pitch-i).add(h.center),r=THREE.Math.yawPitchToPoint(t.yaw,t.pitch-i).add(h.center);s(n,a,o,r)}function a(e,t,i){var n=THREE.Math.yawPitchToPoint(e.yaw,e.pitch+i).add(h.center),a=THREE.Math.yawPitchToPoint(t.yaw,t.pitch+i).add(h.center),o=THREE.Math.yawPitchToPoint(e.yaw,e.pitch).add(h.center),r=THREE.Math.yawPitchToPoint(t.yaw,t.pitch).add(h.center);s(n,a,o,r)}function o(e,t,i){var n=THREE.Math.yawPitchToPoint(e.yaw,e.pitch).add(h.center),a=THREE.Math.yawPitchToPoint(e.yaw+i,e.pitch).add(h.center),o=THREE.Math.yawPitchToPoint(t.yaw,t.pitch).add(h.center),r=THREE.Math.yawPitchToPoint(t.yaw+i,t.pitch).add(h.center);s(n,a,o,r)}function r(e,t,i){var n=THREE.Math.yawPitchToPoint(e.yaw-i,e.pitch).add(h.center),a=THREE.Math.yawPitchToPoint(e.yaw,e.pitch).add(h.center),o=THREE.Math.yawPitchToPoint(t.yaw-i,t.pitch).add(h.center),r=THREE.Math.yawPitchToPoint(t.yaw,t.pitch).add(h.center);s(n,a,o,r)}function s(e,t,n,a){var o=h.vertices.length;h.vertices.push(i(e)),h.vertices.push(i(n)),h.vertices.push(i(t)),h.vertices.push(i(a)),h.faces.push(new THREE.Face3(0+o,2+o,1+o)),h.faces.push(new THREE.Face3(1+o,2+o,3+o))}THREE.Geometry.call(this),this.center=new THREE.Vector3,this.corners=[],this.divide=10,this.dashLinePositionInPercent=.5,this.params={},this.destroy=function(){this.vertices=[],this.faces=[]},this.build=function(){var e=this.params.widthInDeg,i=this.params.heightInDeg,s=.05*Math.min(e,i);s=Math.min(.5,Math.max(.1,s));for(var h=this.divide,c=e/h,l=i/h,d=0;h>d;d++)for(var p=-e/2+c*d,m=0;h>m;m++){var u=-i/2+l*m;if(0==d){var E={yaw:p,pitch:u},f={yaw:p,pitch:u-l};o(E,f,s)}if(d==h-1){var E={yaw:p+c,pitch:u},f={yaw:p+c,pitch:u-l};r(E,f,s)}if(0==m){var E={yaw:p,pitch:u-l},f={yaw:p+c,pitch:u-l};a(E,f,s)}if(m==h-1){var E={yaw:p,pitch:u},f={yaw:p+c,pitch:u};n(E,f,s)}}this.corners=t(),this.mergeVertices(),this.verticesNeedUpdate=!0,this.elementsNeedUpdate=!0,this.normalsNeedUpdate=!0,this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingSphere()},this.rebuild=function(e){return this.params={yaw:e.yaw,pitch:e.pitch,widthInDeg:e.widthInDeg,heightInDeg:e.heightInDeg},this.destroy(),this.build(),this};var h=this;this.rebuild(e)},THREE.RectangleOutlineGeometry.prototype=Object.create(THREE.Geometry.prototype)}),define("mesh/Selection3DOutlineMesh",["three","geometries/RectangleOutlineGeometry"],function(){THREE.Selection3DOutlineMesh=function(e,t,i,n){this.parameters={},this.rebuild=function(e){console.error("Rebuild blur area outline mesh is not supported yet!")};var a=this,o=function(e,t,i,n){null!=e&&(a.parameters.yaw=e),null!=t&&(a.parameters.pitch=t),null!=i&&(a.parameters.heightInDeg=n),null!=n&&(a.parameters.widthInDeg=i)};o(e,t,i,n);var r=new THREE.MeshBasicMaterial({color:"#1155C9",transparent:!0,opacity:.75,overdraw:.1,side:THREE.DoubleSide});this.outlineGeometry=new THREE.RectangleOutlineGeometry(this.parameters),THREE.Mesh.call(this,this.outlineGeometry,r)},THREE.Selection3DOutlineMesh.prototype=Object.create(THREE.Mesh.prototype)}),define("scene/Selection3D",["three","geometries/RectangleGeometry","mesh/Selection3DMesh","mesh/Selection3DOutlineMesh"],function(){THREE.Selection3D=function(){THREE.Object3D.call(this),this.getParameters=function(){return{yaw:this.mesh.parameters.yaw,pitch:this.mesh.parameters.pitch,azimuth:i(this.mesh.parameters.yaw),polar:n(this.mesh.parameters.pitch),heightInDeg:this.mesh.parameters.heightInDeg,widthInDeg:this.mesh.parameters.widthInDeg}},this.updateParameters=function(i){var n=$.extend({},this.getParameters(),i);this.mesh.rebuild({yaw:e(n.azimuth),pitch:t(n.polar),heightInDeg:n.heightInDeg,widthInDeg:n.widthInDeg})},this.printParameters=function(){console.log(this.getParameters())},this.addDynamicMesh=function(i,n,a,o){this.mesh=new THREE.Selection3DMesh(e(i),t(n),a,o),this.mesh.addControllers(),this.children.push(this.mesh)},this.addStaticMesh=function(i,n,a,o){this.mesh=new THREE.Selection3DOutlineMesh(e(i),t(n),a,o),this.children.push(this.mesh)};var e=function(e){return-e%360},t=function(e){return 90-e},i=function(e){var t=-e%360;return(t+360)%360},n=function(e){var t=90-e;return(t+360)%360}},THREE.Selection3D.prototype=Object.create(THREE.Object3D.prototype)}),define("controls/OrbitControls",["three","core/Object3D"],function(){THREE.OrbitControls=function(e,t){this.camera=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.noZoom=!1,this.zoomSpeed=.1,this.minFov=30,this.maxFov=90,this.autoRotate={enable:!1,speed:.1},this.yaw=-90,this.pitch=0,this.selectable=[],this.selected=[];var i=this,n=!1,a=!1,o=0,r=0,s=0,h=0;this.update=function(){!i.autoRotate.enable||n||a||(i.yaw+=i.autoRotate.speed),i.yaw=(i.yaw+180+360)%360-180,i.pitch=Math.max(-85,Math.min(85,i.pitch));var e=THREE.Math.degToRad(i.yaw),t=THREE.Math.degToRad(90-i.pitch),o=new THREE.Vector3;o.x=Math.sin(t)*Math.cos(e),o.y=Math.cos(t),o.z=Math.sin(t)*Math.sin(e),i.camera.lookAt(o)};var c=function(e){var t=i.domElement,n=new THREE.Vector3((e.clientX-t.offsetLeft)/t.width*2-1,2*-((e.clientY-t.offsetTop)/t.height)+1,.5);return n.unproject(i.camera),n.normalize(),n},l=function(e,t){var n=c(e),a=new THREE.Raycaster(i.camera.position,n.sub(i.camera.position).normalize()).intersectObjects(i.selectable,!0);a.length>0?t.succeed&&t.succeed(a):t.fail&&t.fail()},d=function(e){i.enabled!==!1&&(e.preventDefault(),l(e,{succeed:function(e){a=!0;for(var t=0;t<e.length;t++){var n=e[t].object,o=e[t].point;n.onMouseDown(o,!0),i.selected.push(n)}},fail:function(){n=!0,o=e.clientX,r=e.clientY,s=i.yaw,h=i.pitch}}),i.domElement.addEventListener("mousemove",i.onMouseMove,!1))},p=function(e){if(i.enabled!==!1)if(e.preventDefault(),a===!0)for(var t=0;t<i.selected.length;t++)i.selected[t].onMouseMove(c(e),!1);else n===!0&&(i.yaw=.1*(o-e.clientX)+s,i.pitch=.1*(e.clientY-r)+h)},m=function(e){if(i.enabled!==!1){e.preventDefault(),n=!1,a=!1;for(var t=0;t<i.selected.length;t++)i.selected[t].onMouseUp(c(e),!1);i.selected=[],i.domElement.removeEventListener("mousemove",i.onMouseMove,!1)}},u=function(e){if(i.enabled!==!1&&i.noZoom!==!0){e.preventDefault();var t=i.zoomSpeed;e.wheelDeltaY?i.camera.fov-=e.wheelDeltaY*t:e.wheelDelta?i.camera.fov-=e.wheelDelta*t:e.detail&&(i.camera.fov-=e.detail*t),i.camera.fov>i.maxFov&&(i.camera.fov=i.maxFov),i.camera.fov<i.minFov&&(i.camera.fov=i.minFov),i.camera.updateProjectionMatrix()}},E=function(e){i.enabled!==!1&&(e.preventDefault(),1==e.touches.length&&(o=e.touches[0].pageX,r=e.touches[0].pageY,s=i.yaw,h=i.pitch))},f=function(e){i.enabled!==!1&&e.preventDefault()};this.domElement.addEventListener("mouseup",m,!1),this.domElement.addEventListener("mousedown",d,!1),this.domElement.addEventListener("mousemove",p,!1),this.domElement.addEventListener("mousewheel",u,!1),this.domElement.addEventListener("DOMMouseScroll",u,!1),this.domElement.addEventListener("touchstart",E,!1),this.domElement.addEventListener("touchend",f,!1),this.domElement.addEventListener("touchmove",p,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype)}),define("app",["scene/Cube3D","scene/Sphere3D","scene/Selection3D","controls/OrbitControls","dat_gui"],function(e,t){var i=function(e){this.camera=new THREE.PerspectiveCamera(75,e.width()/e.height(),.1,1e3),this.renderer=this.supportsWebGL()?new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new THREE.CanvasRenderer,this.renderer.setSize(e.width(),e.height()),this.controller=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.mapContainer=e[0],this.mapContainer.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,e.resize(this.onWindowResize.bind(this)),this.draw()};return i.prototype.loadScene=function(e){this.createPanorama(e),this.createSelection3D()},i.prototype.clearPanorama=function(){this.scene.remove(this.panorama),this.panorama=null},i.prototype.createPanorama=function(i){i.type||console.error("Please choose a Panorma type!"),i.type===e.TYPE&&e.validate(i)?this.panorama=new e(i).createCube():i.type===t.TYPE&&t.validate(i)&&(this.panorama=new t(i).createSphere()),this.panorama&&this.scene.add(this.panorama)},i.prototype.clearSelection3D=function(){var e=this.controller.selectable.indexOf(this.selection3D);e>-1&&this.controller.selectable.splice(e,1),null!=this.selection3D&&(this.scene.remove(this.selection3D),this.selection3D=null)},i.prototype.createSelection3D=function(e){var t={azimuth:20,polar:90,width:10,height:10,focus:!0,"static":!1,enable:!1},i=$.extend(t,e);i.enable&&(this.selection3D=new THREE.Selection3D,i["static"]?this.selection3D.addStaticMesh(i.azimuth,i.polar,i.width,i.height):this.selection3D.addDynamicMesh(i.azimuth,i.polar,i.width,i.height),this.scene.add(this.selection3D),i.focus&&(this.controller.yaw=this.selection3D.getParameters().yaw,this.controller.pitch=this.selection3D.getParameters().pitch),i["static"]||this.controller.selectable.push(this.selection3D))},i.prototype.createDebugGUI=function(){var e=new dat.GUI,t=this,i=e.addFolder("AutoRotate");i.add(this.controller.autoRotate,"enable"),i.add(this.controller.autoRotate,"speed").min(.1).max(1),i.open();var n=e.addFolder("Camera");if(n.add(this.controller,"yaw").min(-180).max(180).listen(),n.add(this.controller,"pitch").min(-85).max(85).listen(),n.add(this.camera,"fov").min(this.controller.minFov).max(this.controller.maxFov).listen().onChange(function(){t.camera.updateProjectionMatrix()}),n.open(),this.selection3D){var a=e.addFolder("Blur");a.add(this.selection3D.mesh.parameters,"yaw").listen(),a.add(this.selection3D.mesh.parameters,"pitch").listen(),a.add(this.selection3D.mesh.parameters,"widthInDeg").listen(),a.add(this.selection3D.mesh.parameters,"heightInDeg").listen(),a.open()}},i.prototype.supportsWebGL=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}},i.prototype.update=function(){this.controller.update(),this.renderer.render(this.scene,this.camera)},i.prototype.draw=function(){requestAnimationFrame(this.draw.bind(this)),this.update()},i.prototype.onWindowResize=function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},$.fn.panorama=function(e){var t="zhanghaowx-panorama",n=$(this).data(t);if(n)n.clearPanorama(),n.loadScene(e);else{var n=new i(this);n.loadScene(e),$(this).data(t,n)}return n},e});